import{r,j as a}from"./index-yVe0ixWJ.js";import{C as ke,i,R as be,_ as ge,a as fe,t as le,P as Q,g as ve,b as Ce,c as Ae}from"./window-siO1LhKq.js";function Me({zoom:n,angle:e,device:t,setDevice:s,setFramerate:o}){const p=r.useRef(null),u=r.useRef(null),[m,l]=r.useState(4/3),[y,A]=r.useState(n),[w,g]=r.useState(e),d=r.useRef(".2s"),c=d.current,h=r.useRef(null),M=r.useRef(null),_=p.current,k=u.current;r.useEffect(()=>{d.current=".0s"},[]),r.useEffect(()=>{d.current=".2s",A(n),setTimeout(()=>{d.current=".0s"},1e3)},[n]),r.useEffect(()=>{d.current=".2s",g(e),setTimeout(()=>{d.current=".0s"},1e3)},[e]);const j=r.useCallback(async()=>{h.current&&clearInterval(h.current),M.current&&M.current.getTracks().forEach(x=>x.stop());try{const x=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:t?t.deviceId:""}}});if(M.current=x,_&&k){const R=x.getTracks()[0],F=R.getConstraints(),{height:T,width:U}=R.getCapabilities();let z=0;const q=()=>{_.requestVideoFrameCallback(q),z++};q();const ie=setInterval(()=>{o(z),z=0},1e3);if(h.current=ie,T&&U){const W=T.max||480,G=U.max||640;k.height=W,k.width=G,F.height=W,F.width=G,l(W/G),R.applyConstraints(F)}_.srcObject=x}}catch(x){console.error("error:",x),s(void 0)}},[k,t,s,o,_]);r.useEffect(()=>(j(),()=>{h.current&&clearInterval(h.current)}),[t,j]);let f=window.innerWidth+window.innerWidth*(y/100),v=window.innerHeight+window.innerHeight*(y/100);f<v/m&&(f=v/m),v<f*m&&(v=f*m);const $=`${v}px`,te=`${f}px`;function ne(){return w%180}const se=`rotate(${w}deg) scale(${ne()?1/m:1})`;return a.jsxs("div",{style:{transform:se,position:"relative",overflow:"scroll",height:$,width:te,transitionDuration:c},children:[a.jsx("video",{autoPlay:!0,id:"videoElement",ref:p}),a.jsx("canvas",{id:"canvas",ref:u,style:{display:"none"},children:" "})]})}function _e({zoom:n,zoomIn:e,zoomOut:t,zoomActual:s,rotateCCW:o,rotateCW:p,device:u,setDevice:m,deviceList:l,framerate:y}){const[A,w]=r.useState(0);function g(c){const h=+c.target.value;w(h),l&&m(l[h])}const d=r.useCallback(()=>{for(const c in l)if((u==null?void 0:u.deviceId)===l[+c].deviceId)return+c;return 0},[u==null?void 0:u.deviceId,l]);return r.useEffect(()=>{w(d())},[l,u,d]),a.jsx("div",{className:"HUD",children:a.jsxs("div",{className:"bottomHUD",children:[a.jsx("button",{onClick:s,title:"Revert Zoom and Rotation",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-square",viewBox:"0 0 16 16",children:a.jsx("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"})})}),a.jsx("button",{onClick:e,title:"Zoom In",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-zoom-in",viewBox:"0 0 16 16",children:[a.jsx("path",{fillRule:"evenodd",d:"M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"}),a.jsx("path",{d:"M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"}),a.jsx("path",{fillRule:"evenodd",d:"M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"})]})}),a.jsx("button",{onClick:t,title:"Zoom Out",disabled:n<=0,children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-zoom-out",viewBox:"0 0 16 16",children:[a.jsx("path",{fillRule:"evenodd",d:"M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"}),a.jsx("path",{d:"M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"}),a.jsx("path",{fillRule:"evenodd",d:"M3 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"})]})}),a.jsx("button",{onClick:o,title:"Rotate Left",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-counterclockwise",viewBox:"0 0 16 16",children:[a.jsx("path",{fillRule:"evenodd",d:"M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"}),a.jsx("path",{d:"M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"})]})}),a.jsx("button",{onClick:p,title:"Rotate Right",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"bi bi-arrow-clockwise",viewBox:"0 0 16 16",children:[a.jsx("path",{fillRule:"evenodd",d:"M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"}),a.jsx("path",{d:"M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"})]})}),a.jsx("select",{name:"device-select",id:"device-select",value:A,onChange:g,children:l==null?void 0:l.map((c,h)=>a.jsx("option",{value:h,children:c.label},h))}),a.jsxs("button",{style:{position:"fixed",right:"8px"},children:[y," fps"]})]})})}function je(){return a.jsx("div",{"data-tauri-drag-region":!0,className:"drag"})}var J,K;function xe(n){var e;if("items"in n)n.items=(e=n.items)===null||e===void 0?void 0:e.map(t=>"rid"in t?t:xe(t));else if("action"in n&&n.action){const t=new ke;return t.onmessage=n.action,delete n.action,{...n,handler:t}}return n}async function V(n,e){const t=new ke;if(e&&typeof e=="object"&&("action"in e&&e.action&&(t.onmessage=e.action,delete e.action),"items"in e&&e.items)){let s=function(o){var p;return"rid"in o?[o.rid,o.kind]:("item"in o&&typeof o.item=="object"&&(!((p=o.item.About)===null||p===void 0)&&p.icon)&&(o.item.About.icon=le(o.item.About.icon)),"icon"in o&&o.icon&&(o.icon=le(o.icon)),"items"in o&&o.items&&(o.items=o.items.map(s)),xe(o))};e.items=e.items.map(s)}return i("plugin:menu|new",{kind:n,options:e,handler:t})}class B extends be{get id(){return ge(this,J,"f")}get kind(){return ge(this,K,"f")}constructor(e,t,s){super(e),J.set(this,void 0),K.set(this,void 0),fe(this,J,t),fe(this,K,s)}}J=new WeakMap,K=new WeakMap;class X extends B{constructor(e,t){super(e,t,"MenuItem")}static async new(e){return V("MenuItem",e).then(([t,s])=>new X(t,s))}async text(){return i("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return i("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}async isEnabled(){return i("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(e){return i("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:e})}async setAccelerator(e){return i("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:e})}}class Y extends B{constructor(e,t){super(e,t,"Check")}static async new(e){return V("Check",e).then(([t,s])=>new Y(t,s))}async text(){return i("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return i("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}async isEnabled(){return i("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(e){return i("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:e})}async setAccelerator(e){return i("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:e})}async isChecked(){return i("plugin:menu|is_checked",{rid:this.rid})}async setChecked(e){return i("plugin:menu|set_checked",{rid:this.rid,checked:e})}}var we;(function(n){n.Add="Add",n.Advanced="Advanced",n.Bluetooth="Bluetooth",n.Bookmarks="Bookmarks",n.Caution="Caution",n.ColorPanel="ColorPanel",n.ColumnView="ColumnView",n.Computer="Computer",n.EnterFullScreen="EnterFullScreen",n.Everyone="Everyone",n.ExitFullScreen="ExitFullScreen",n.FlowView="FlowView",n.Folder="Folder",n.FolderBurnable="FolderBurnable",n.FolderSmart="FolderSmart",n.FollowLinkFreestanding="FollowLinkFreestanding",n.FontPanel="FontPanel",n.GoLeft="GoLeft",n.GoRight="GoRight",n.Home="Home",n.IChatTheater="IChatTheater",n.IconView="IconView",n.Info="Info",n.InvalidDataFreestanding="InvalidDataFreestanding",n.LeftFacingTriangle="LeftFacingTriangle",n.ListView="ListView",n.LockLocked="LockLocked",n.LockUnlocked="LockUnlocked",n.MenuMixedState="MenuMixedState",n.MenuOnState="MenuOnState",n.MobileMe="MobileMe",n.MultipleDocuments="MultipleDocuments",n.Network="Network",n.Path="Path",n.PreferencesGeneral="PreferencesGeneral",n.QuickLook="QuickLook",n.RefreshFreestanding="RefreshFreestanding",n.Refresh="Refresh",n.Remove="Remove",n.RevealFreestanding="RevealFreestanding",n.RightFacingTriangle="RightFacingTriangle",n.Share="Share",n.Slideshow="Slideshow",n.SmartBadge="SmartBadge",n.StatusAvailable="StatusAvailable",n.StatusNone="StatusNone",n.StatusPartiallyAvailable="StatusPartiallyAvailable",n.StatusUnavailable="StatusUnavailable",n.StopProgressFreestanding="StopProgressFreestanding",n.StopProgress="StopProgress",n.TrashEmpty="TrashEmpty",n.TrashFull="TrashFull",n.User="User",n.UserAccounts="UserAccounts",n.UserGroup="UserGroup",n.UserGuest="UserGuest"})(we||(we={}));class N extends B{constructor(e,t){super(e,t,"Icon")}static async new(e){return V("Icon",e).then(([t,s])=>new N(t,s))}async text(){return i("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return i("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}async isEnabled(){return i("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(e){return i("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:e})}async setAccelerator(e){return i("plugin:menu|set_accelerator",{rid:this.rid,kind:this.kind,accelerator:e})}async setIcon(e){return i("plugin:menu|set_icon",{rid:this.rid,icon:le(e)})}}class ee extends B{constructor(e,t){super(e,t,"Predefined")}static async new(e){return V("Predefined",e).then(([t,s])=>new ee(t,s))}async text(){return i("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return i("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}}function ae([n,e,t]){switch(t){case"Submenu":return new O(n,e);case"Predefined":return new ee(n,e);case"Check":return new Y(n,e);case"Icon":return new N(n,e);case"MenuItem":default:return new X(n,e)}}class O extends B{constructor(e,t){super(e,t,"Submenu")}static async new(e){return V("Submenu",e).then(([t,s])=>new O(t,s))}async text(){return i("plugin:menu|text",{rid:this.rid,kind:this.kind})}async setText(e){return i("plugin:menu|set_text",{rid:this.rid,kind:this.kind,text:e})}async isEnabled(){return i("plugin:menu|is_enabled",{rid:this.rid,kind:this.kind})}async setEnabled(e){return i("plugin:menu|set_enabled",{rid:this.rid,kind:this.kind,enabled:e})}async append(e){return i("plugin:menu|append",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(t=>"rid"in t?[t.rid,t.kind]:t)})}async prepend(e){return i("plugin:menu|prepend",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(t=>"rid"in t?[t.rid,t.kind]:t)})}async insert(e,t){return i("plugin:menu|insert",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(s=>"rid"in s?[s.rid,s.kind]:s),position:t})}async remove(e){return i("plugin:menu|remove",{rid:this.rid,kind:this.kind,item:[e.rid,e.kind]})}async removeAt(e){return i("plugin:menu|remove_at",{rid:this.rid,kind:this.kind,position:e}).then(ae)}async items(){return i("plugin:menu|items",{rid:this.rid,kind:this.kind}).then(e=>e.map(ae))}async get(e){return i("plugin:menu|get",{rid:this.rid,kind:this.kind,id:e}).then(t=>t?ae(t):null)}async popup(e,t){var s;return i("plugin:menu|popup",{rid:this.rid,kind:this.kind,window:(s=t==null?void 0:t.label)!==null&&s!==void 0?s:null,at:e instanceof Q?e:e?new Q(e):null})}async setAsWindowsMenuForNSApp(){return i("plugin:menu|set_as_windows_menu_for_nsapp",{rid:this.rid})}async setAsHelpMenuForNSApp(){return i("plugin:menu|set_as_help_menu_for_nsapp",{rid:this.rid})}}function oe([n,e,t]){switch(t){case"Submenu":return new O(n,e);case"Predefined":return new ee(n,e);case"Check":return new Y(n,e);case"Icon":return new N(n,e);case"MenuItem":default:return new X(n,e)}}class D extends B{constructor(e,t){super(e,t,"Menu")}static async new(e){return V("Menu",e).then(([t,s])=>new D(t,s))}static async default(){return i("plugin:menu|create_default").then(([e,t])=>new D(e,t))}async append(e){return i("plugin:menu|append",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(t=>"rid"in t?[t.rid,t.kind]:t)})}async prepend(e){return i("plugin:menu|prepend",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(t=>"rid"in t?[t.rid,t.kind]:t)})}async insert(e,t){return i("plugin:menu|insert",{rid:this.rid,kind:this.kind,items:(Array.isArray(e)?e:[e]).map(s=>"rid"in s?[s.rid,s.kind]:s),position:t})}async remove(e){return i("plugin:menu|remove",{rid:this.rid,kind:this.kind,item:[e.rid,e.kind]})}async removeAt(e){return i("plugin:menu|remove_at",{rid:this.rid,kind:this.kind,position:e}).then(oe)}async items(){return i("plugin:menu|items",{rid:this.rid,kind:this.kind}).then(e=>e.map(oe))}async get(e){return i("plugin:menu|get",{rid:this.rid,kind:this.kind,id:e}).then(t=>t?oe(t):null)}async popup(e,t){var s;return i("plugin:menu|popup",{rid:this.rid,kind:this.kind,window:(s=t==null?void 0:t.label)!==null&&s!==void 0?s:null,at:e instanceof Q?e:e?new Q(e):null})}async setAsAppMenu(){return i("plugin:menu|set_as_app_menu",{rid:this.rid}).then(e=>e?new D(e[0],e[1]):null)}async setAsWindowMenu(e){var t;return i("plugin:menu|set_as_window_menu",{rid:this.rid,window:(t=e==null?void 0:e.label)!==null&&t!==void 0?t:null}).then(s=>s?new D(s[0],s[1]):null)}}const Re=navigator.userAgent.includes("Macintosh");async function ye(n,e,t){const{zoom:s,zoomIn:o,zoomOut:p,zoomActual:u,rotateCCW:m,rotateCW:l,setDevice:y,setAlwaysOnTop:A,alwaysOnTop:w,setEnableHUD:g,enableHUD:d}=t,c=await O.new({text:"View",items:[{text:"Actual Size",enabled:!0,accelerator:"CommandOrControl+0",action:()=>{u()}},{item:"Separator"},{text:"Zoom In",enabled:!0,accelerator:"CommandOrControl+NUMADD",action:()=>{o()}},{text:"Zoom Out",enabled:s>0,accelerator:"CommandOrControl+NUMSUBTRACT",action:()=>{p()}},{text:"Rotate Left",enabled:!0,accelerator:"CommandOrControl+L",action:()=>{m()}},{text:"Rotate Right",enabled:!0,accelerator:"CommandOrControl+R",action:()=>{l()}},{item:"Separator"},{text:"Always on Top",checked:w??!1,accelerator:"CommandOrControl+T",enabled:!0,action:()=>{A(!w)}},{text:"Hide Heads Up Display",checked:!(d??!1),accelerator:"CommandOrControl+U",enabled:!0,action:()=>{g(!d)}},{item:"Separator"}]}),h=e==null?void 0:e.map(f=>n?{text:f.label,enabled:!0,checked:f.deviceId===n.deviceId,action:()=>{y(f),ye(f,e,t)}}:{text:"No Devices"}),M=await O.new({text:"Devices",items:h}),k=await(await D.default()).items();k.splice(1,3,M),k.splice(2,2,c);const j=await D.new({items:k});await(Re?j.setAsAppMenu():j.setAsWindowMenu())}const Z=typeof window<"u"&&"__TAURI__"in window,C=Z?ve():null;function De(){const[,n]=r.useState(0),[,e]=r.useState(0),[t,s]=r.useState(0),[o,p]=r.useState(0),[u,m]=r.useState(),[l,y]=r.useState(),[A,w]=r.useState(!1),[g,d]=r.useState(null),[c,h]=r.useState(null),[M,_]=r.useState(),[k,j]=r.useState([]),[f,v]=r.useState({}),[$,te]=r.useState(-1),[ne,se]=r.useState(0),x=r.useCallback(()=>{s(t+10)},[t]),R=r.useCallback(()=>{s(t>10?t-10:0),console.log(t)},[t]),F=r.useCallback(()=>{s(0),p(0)},[]),T=r.useCallback(()=>{p(o-45)},[o]),U=r.useCallback(()=>{p(o+45)},[o]);r.useEffect(()=>{Z&&(C.setAlwaysOnTop(c??!1),c!==null&&localStorage.setItem("always-on-top",(+c).toString()))},[c]),r.useEffect(()=>{g!==null&&localStorage.setItem("enable-HUD",(+g).toString())},[g]);const z=r.useMemo(()=>({zoom:t,zoomIn:x,zoomOut:R,zoomActual:F,rotateCCW:T,rotateCW:U,setDevice:m,alwaysOnTop:c,setAlwaysOnTop:h,enableHUD:g,setEnableHUD:d}),[t,x,R,F,T,U,m,c,h,g,d]);r.useEffect(()=>{const S=localStorage.getItem("height"),P=localStorage.getItem("width"),H=localStorage.getItem("x"),E=localStorage.getItem("y"),I=!!+(localStorage.getItem("always-on-top")??"0"),re=!!+(localStorage.getItem("enable-HUD")??"1"),ue=S?+S:null,de=P?+P:null,ce=H?+H:null,he=E?+E:null;Z?(async()=>(d(re),h(I),ce&&he&&await C.setPosition(new Ce(ce,he)),ue&&de&&await C.setSize(new Ae(de,ue)),await C.show()))():d(!0);const me=localStorage.getItem("showSidebar");if(me){const L=+me;_(!!L)}const pe=localStorage.getItem("device");if(pe){const L=JSON.parse(pe);m(L)}if(Z){const L=C.listen("tauri://move",async()=>{const b=await C.outerPosition();localStorage.setItem("x",b.x.toString()),localStorage.setItem("y",b.y.toString())}),Se=C.listen("tauri://resize",async()=>{const b=await C.innerSize();localStorage.setItem("height",b.height.toString()),localStorage.setItem("width",b.width.toString()),e(b.height),n(b.width)});return document.addEventListener("contextmenu",b=>{b.preventDefault()}),()=>{(async()=>((await L)(),(await Se)()))()}}},[]),r.useEffect(()=>{const S=setInterval(()=>{(async()=>{const H=(await G()).filter(I=>I.kind==="videoinput");let E=!1;l&&(E=H.length!==l.length,E||(E=H.filter((I,re)=>I.deviceId!==l[re].deviceId).length>0)),(E||!l)&&y(H)})()},2e3);return()=>{clearInterval(S)}},[l]),r.useEffect(()=>{if(u&&Z&&ye(u,l,z),l&&!u){let S=l[0];for(const P in l)if(l[P].label.includes("Microscope")){S=l[P];break}m(S)}},[l,u,z]),r.useEffect(()=>{u&&localStorage.setItem("device",JSON.stringify(u))},[u]);function q(S){j([S,...k])}function ie(){v({})}function W(){te(-1)}async function G(){return await navigator.mediaDevices.enumerateDevices()}return a.jsxs("div",{className:"App",onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),children:[a.jsx("div",{style:{width:"100%",height:"60px",position:"fixed",top:0,zIndex:1},children:a.jsx(je,{})}),a.jsx("div",{children:a.jsx(Me,{zoom:t,angle:o,device:u,setDevice:m,setDeviceList:y,addImage:q,takeSnapshot:f,snapshotToShow:k[$],setFramerate:se})}),a.jsx("div",{style:{position:"absolute",transitionProperty:"opacity, left",transitionDuration:".5s, .1s",opacity:A&&g?1:0,left:`${M?11:1}em`,zIndex:"2"},children:a.jsx(_e,{zoom:t,zoomIn:x,zoomOut:R,zoomActual:F,rotateCCW:T,rotateCW:U,device:u,setDevice:m,deviceList:l,setDeviceList:y,takeSnapshot:ie,closeSnapshot:W,showSnapshot:$>-1,framerate:ne})})]})}export{De as default};
